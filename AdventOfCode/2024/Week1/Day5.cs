using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace AdventOfCode._2024
{
    internal class Day5() : Problem("47|53\r\n97|13\r\n97|61\r\n97|47\r\n75|29\r\n61|13\r\n75|53\r\n29|13\r\n97|29\r\n53|29\r\n61|53\r\n97|53\r\n61|29\r\n47|13\r\n75|47\r\n97|75\r\n47|61\r\n75|61\r\n47|29\r\n75|13\r\n53|13\r\n\r\n75,47,61,53,29\r\n97,61,53,29,13\r\n75,29,13\r\n75,97,47,61,53\r\n61,13,29\r\n97,13,75,29,47",
        "86|99\r\n69|32\r\n69|42\r\n77|99\r\n77|72\r\n77|38\r\n21|57\r\n21|89\r\n21|65\r\n21|47\r\n47|53\r\n47|75\r\n47|62\r\n47|69\r\n47|38\r\n95|72\r\n95|16\r\n95|94\r\n95|15\r\n95|89\r\n95|53\r\n51|94\r\n51|95\r\n51|53\r\n51|77\r\n51|15\r\n51|16\r\n51|57\r\n49|27\r\n49|17\r\n49|97\r\n49|29\r\n49|87\r\n49|38\r\n49|11\r\n49|55\r\n31|86\r\n31|77\r\n31|34\r\n31|94\r\n31|26\r\n31|85\r\n31|79\r\n31|36\r\n31|57\r\n94|77\r\n94|91\r\n94|99\r\n94|62\r\n94|53\r\n94|61\r\n94|56\r\n94|69\r\n94|26\r\n94|83\r\n35|94\r\n35|99\r\n35|91\r\n35|29\r\n35|97\r\n35|89\r\n35|49\r\n35|56\r\n35|47\r\n35|86\r\n35|27\r\n53|62\r\n53|42\r\n53|69\r\n53|76\r\n53|59\r\n53|27\r\n53|49\r\n53|72\r\n53|11\r\n53|89\r\n53|26\r\n53|91\r\n24|94\r\n24|95\r\n24|15\r\n24|47\r\n24|64\r\n24|65\r\n24|91\r\n24|35\r\n24|49\r\n24|16\r\n24|75\r\n24|51\r\n24|89\r\n75|32\r\n75|91\r\n75|42\r\n75|99\r\n75|11\r\n75|62\r\n75|97\r\n75|72\r\n75|83\r\n75|59\r\n75|53\r\n75|56\r\n75|27\r\n75|29\r\n89|73\r\n89|62\r\n89|97\r\n89|99\r\n89|83\r\n89|38\r\n89|56\r\n89|15\r\n89|29\r\n89|87\r\n89|55\r\n89|27\r\n89|76\r\n89|11\r\n89|17\r\n87|33\r\n87|11\r\n87|57\r\n87|34\r\n87|51\r\n87|95\r\n87|45\r\n87|36\r\n87|31\r\n87|64\r\n87|98\r\n87|35\r\n87|85\r\n87|55\r\n87|21\r\n87|32\r\n45|75\r\n45|86\r\n45|16\r\n45|57\r\n45|72\r\n45|99\r\n45|49\r\n45|53\r\n45|64\r\n45|51\r\n45|26\r\n45|15\r\n45|95\r\n45|77\r\n45|69\r\n45|59\r\n45|89\r\n42|27\r\n42|62\r\n42|17\r\n42|79\r\n42|31\r\n42|34\r\n42|36\r\n42|98\r\n42|56\r\n42|32\r\n42|24\r\n42|11\r\n42|85\r\n42|87\r\n42|97\r\n42|55\r\n42|83\r\n42|76\r\n29|17\r\n29|87\r\n29|55\r\n29|73\r\n29|76\r\n29|11\r\n29|27\r\n29|61\r\n29|45\r\n29|79\r\n29|36\r\n29|85\r\n29|62\r\n29|83\r\n29|25\r\n29|97\r\n29|32\r\n29|24\r\n29|98\r\n57|91\r\n57|15\r\n57|16\r\n57|42\r\n57|72\r\n57|38\r\n57|89\r\n57|65\r\n57|99\r\n57|69\r\n57|53\r\n57|26\r\n57|59\r\n57|49\r\n57|97\r\n57|94\r\n57|64\r\n57|35\r\n57|56\r\n57|29\r\n33|24\r\n33|57\r\n33|21\r\n33|94\r\n33|64\r\n33|77\r\n33|75\r\n33|16\r\n33|79\r\n33|34\r\n33|51\r\n33|47\r\n33|86\r\n33|65\r\n33|26\r\n33|36\r\n33|95\r\n33|49\r\n33|91\r\n33|45\r\n33|35\r\n79|24\r\n79|64\r\n79|45\r\n79|26\r\n79|85\r\n79|72\r\n79|65\r\n79|94\r\n79|75\r\n79|16\r\n79|35\r\n79|34\r\n79|57\r\n79|91\r\n79|49\r\n79|86\r\n79|36\r\n79|53\r\n79|95\r\n79|51\r\n79|47\r\n79|77\r\n26|49\r\n26|42\r\n26|25\r\n26|62\r\n26|73\r\n26|69\r\n26|99\r\n26|65\r\n26|97\r\n26|59\r\n26|87\r\n26|32\r\n26|11\r\n26|38\r\n26|29\r\n26|27\r\n26|15\r\n26|83\r\n26|89\r\n26|76\r\n26|98\r\n26|56\r\n26|61\r\n99|42\r\n99|56\r\n99|97\r\n99|79\r\n99|25\r\n99|59\r\n99|76\r\n99|38\r\n99|36\r\n99|55\r\n99|17\r\n99|98\r\n99|61\r\n99|11\r\n99|73\r\n99|24\r\n99|62\r\n99|32\r\n99|33\r\n99|27\r\n99|87\r\n99|83\r\n99|31\r\n99|29\r\n83|57\r\n83|36\r\n83|98\r\n83|33\r\n83|95\r\n83|45\r\n83|62\r\n83|31\r\n83|25\r\n83|51\r\n83|85\r\n83|11\r\n83|24\r\n83|34\r\n83|27\r\n83|73\r\n83|61\r\n83|21\r\n83|87\r\n83|32\r\n83|55\r\n83|17\r\n83|79\r\n83|76\r\n11|98\r\n11|57\r\n11|45\r\n11|25\r\n11|79\r\n11|94\r\n11|55\r\n11|34\r\n11|73\r\n11|21\r\n11|24\r\n11|35\r\n11|47\r\n11|51\r\n11|16\r\n11|95\r\n11|77\r\n11|85\r\n11|86\r\n11|64\r\n11|17\r\n11|31\r\n11|33\r\n11|36\r\n15|62\r\n15|29\r\n15|59\r\n15|11\r\n15|36\r\n15|27\r\n15|33\r\n15|73\r\n15|83\r\n15|79\r\n15|56\r\n15|76\r\n15|25\r\n15|31\r\n15|17\r\n15|98\r\n15|38\r\n15|61\r\n15|42\r\n15|32\r\n15|99\r\n15|97\r\n15|55\r\n15|87\r\n64|49\r\n64|53\r\n64|94\r\n64|26\r\n64|91\r\n64|42\r\n64|16\r\n64|83\r\n64|15\r\n64|69\r\n64|86\r\n64|97\r\n64|47\r\n64|99\r\n64|72\r\n64|59\r\n64|89\r\n64|65\r\n64|77\r\n64|56\r\n64|75\r\n64|35\r\n64|29\r\n64|38\r\n38|79\r\n38|85\r\n38|36\r\n38|25\r\n38|21\r\n38|34\r\n38|24\r\n38|55\r\n38|83\r\n38|45\r\n38|73\r\n38|33\r\n38|61\r\n38|51\r\n38|76\r\n38|32\r\n38|98\r\n38|62\r\n38|31\r\n38|95\r\n38|17\r\n38|27\r\n38|11\r\n38|87\r\n16|94\r\n16|97\r\n16|53\r\n16|59\r\n16|75\r\n16|56\r\n16|27\r\n16|72\r\n16|91\r\n16|62\r\n16|38\r\n16|87\r\n16|26\r\n16|29\r\n16|77\r\n16|49\r\n16|42\r\n16|15\r\n16|86\r\n16|69\r\n16|99\r\n16|65\r\n16|83\r\n16|89\r\n55|57\r\n55|72\r\n55|77\r\n55|85\r\n55|79\r\n55|26\r\n55|24\r\n55|75\r\n55|64\r\n55|65\r\n55|45\r\n55|86\r\n55|94\r\n55|35\r\n55|34\r\n55|51\r\n55|16\r\n55|91\r\n55|33\r\n55|36\r\n55|53\r\n55|95\r\n55|47\r\n55|21\r\n76|85\r\n76|25\r\n76|79\r\n76|73\r\n76|36\r\n76|94\r\n76|33\r\n76|57\r\n76|16\r\n76|31\r\n76|35\r\n76|45\r\n76|34\r\n76|47\r\n76|64\r\n76|32\r\n76|55\r\n76|24\r\n76|17\r\n76|95\r\n76|51\r\n76|11\r\n76|21\r\n76|98\r\n56|62\r\n56|97\r\n56|98\r\n56|45\r\n56|24\r\n56|38\r\n56|73\r\n56|17\r\n56|79\r\n56|85\r\n56|25\r\n56|36\r\n56|33\r\n56|61\r\n56|11\r\n56|32\r\n56|34\r\n56|76\r\n56|83\r\n56|31\r\n56|87\r\n56|55\r\n56|27\r\n56|21\r\n98|79\r\n98|35\r\n98|51\r\n98|33\r\n98|45\r\n98|95\r\n98|25\r\n98|75\r\n98|57\r\n98|31\r\n98|24\r\n98|17\r\n98|21\r\n98|16\r\n98|77\r\n98|55\r\n98|85\r\n98|64\r\n98|34\r\n98|86\r\n98|53\r\n98|47\r\n98|94\r\n98|36\r\n25|85\r\n25|36\r\n25|79\r\n25|51\r\n25|53\r\n25|55\r\n25|24\r\n25|21\r\n25|64\r\n25|33\r\n25|16\r\n25|95\r\n25|57\r\n25|86\r\n25|31\r\n25|47\r\n25|45\r\n25|34\r\n25|35\r\n25|77\r\n25|17\r\n25|94\r\n25|91\r\n25|75\r\n27|61\r\n27|85\r\n27|45\r\n27|87\r\n27|21\r\n27|73\r\n27|79\r\n27|33\r\n27|55\r\n27|62\r\n27|17\r\n27|24\r\n27|76\r\n27|11\r\n27|98\r\n27|32\r\n27|95\r\n27|31\r\n27|51\r\n27|25\r\n27|34\r\n27|57\r\n27|64\r\n27|36\r\n73|57\r\n73|24\r\n73|85\r\n73|77\r\n73|94\r\n73|25\r\n73|35\r\n73|16\r\n73|34\r\n73|36\r\n73|98\r\n73|51\r\n73|86\r\n73|64\r\n73|21\r\n73|75\r\n73|33\r\n73|31\r\n73|79\r\n73|95\r\n73|47\r\n73|45\r\n73|17\r\n73|55\r\n62|79\r\n62|24\r\n62|87\r\n62|76\r\n62|61\r\n62|45\r\n62|57\r\n62|36\r\n62|33\r\n62|25\r\n62|17\r\n62|21\r\n62|64\r\n62|31\r\n62|32\r\n62|55\r\n62|73\r\n62|35\r\n62|85\r\n62|95\r\n62|11\r\n62|98\r\n62|34\r\n62|51\r\n17|79\r\n17|57\r\n17|16\r\n17|47\r\n17|53\r\n17|26\r\n17|91\r\n17|51\r\n17|94\r\n17|77\r\n17|31\r\n17|21\r\n17|75\r\n17|24\r\n17|86\r\n17|95\r\n17|85\r\n17|36\r\n17|55\r\n17|34\r\n17|33\r\n17|45\r\n17|64\r\n17|35\r\n36|51\r\n36|77\r\n36|95\r\n36|47\r\n36|35\r\n36|65\r\n36|64\r\n36|53\r\n36|91\r\n36|45\r\n36|24\r\n36|72\r\n36|26\r\n36|86\r\n36|21\r\n36|69\r\n36|75\r\n36|34\r\n36|94\r\n36|89\r\n36|49\r\n36|57\r\n36|85\r\n36|16\r\n61|31\r\n61|32\r\n61|35\r\n61|24\r\n61|95\r\n61|98\r\n61|79\r\n61|76\r\n61|17\r\n61|47\r\n61|21\r\n61|33\r\n61|34\r\n61|16\r\n61|45\r\n61|73\r\n61|11\r\n61|51\r\n61|25\r\n61|57\r\n61|85\r\n61|64\r\n61|36\r\n61|55\r\n72|59\r\n72|83\r\n72|76\r\n72|97\r\n72|38\r\n72|42\r\n72|31\r\n72|11\r\n72|87\r\n72|89\r\n72|25\r\n72|98\r\n72|99\r\n72|27\r\n72|56\r\n72|32\r\n72|29\r\n72|17\r\n72|62\r\n72|49\r\n72|73\r\n72|61\r\n72|15\r\n72|69\r\n91|26\r\n91|99\r\n91|72\r\n91|73\r\n91|56\r\n91|27\r\n91|11\r\n91|15\r\n91|98\r\n91|59\r\n91|89\r\n91|49\r\n91|83\r\n91|42\r\n91|97\r\n91|65\r\n91|32\r\n91|87\r\n91|76\r\n91|29\r\n91|38\r\n91|61\r\n91|69\r\n91|62\r\n59|76\r\n59|98\r\n59|97\r\n59|38\r\n59|56\r\n59|83\r\n59|31\r\n59|79\r\n59|24\r\n59|27\r\n59|32\r\n59|62\r\n59|85\r\n59|61\r\n59|87\r\n59|55\r\n59|17\r\n59|36\r\n59|33\r\n59|73\r\n59|42\r\n59|29\r\n59|25\r\n59|11\r\n34|91\r\n34|59\r\n34|47\r\n34|89\r\n34|72\r\n34|99\r\n34|65\r\n34|69\r\n34|75\r\n34|86\r\n34|95\r\n34|26\r\n34|57\r\n34|77\r\n34|51\r\n34|15\r\n34|35\r\n34|29\r\n34|94\r\n34|64\r\n34|49\r\n34|53\r\n34|21\r\n34|16\r\n65|49\r\n65|56\r\n65|32\r\n65|72\r\n65|69\r\n65|97\r\n65|83\r\n65|25\r\n65|98\r\n65|27\r\n65|62\r\n65|29\r\n65|73\r\n65|38\r\n65|59\r\n65|99\r\n65|89\r\n65|61\r\n65|87\r\n65|17\r\n65|76\r\n65|42\r\n65|15\r\n65|11\r\n32|55\r\n32|35\r\n32|57\r\n32|16\r\n32|45\r\n32|94\r\n32|73\r\n32|79\r\n32|34\r\n32|17\r\n32|77\r\n32|98\r\n32|64\r\n32|36\r\n32|95\r\n32|85\r\n32|51\r\n32|47\r\n32|24\r\n32|25\r\n32|11\r\n32|31\r\n32|33\r\n32|21\r\n85|21\r\n85|26\r\n85|47\r\n85|64\r\n85|65\r\n85|49\r\n85|95\r\n85|57\r\n85|45\r\n85|89\r\n85|16\r\n85|35\r\n85|51\r\n85|15\r\n85|99\r\n85|86\r\n85|72\r\n85|53\r\n85|91\r\n85|69\r\n85|75\r\n85|34\r\n85|94\r\n85|77\r\n97|98\r\n97|73\r\n97|21\r\n97|24\r\n97|36\r\n97|61\r\n97|87\r\n97|31\r\n97|33\r\n97|38\r\n97|11\r\n97|62\r\n97|32\r\n97|25\r\n97|17\r\n97|85\r\n97|27\r\n97|34\r\n97|55\r\n97|83\r\n97|51\r\n97|45\r\n97|76\r\n97|79\r\n86|38\r\n86|27\r\n86|76\r\n86|56\r\n86|87\r\n86|59\r\n86|65\r\n86|69\r\n86|32\r\n86|61\r\n86|15\r\n86|42\r\n86|72\r\n86|89\r\n86|26\r\n86|62\r\n86|83\r\n86|97\r\n86|53\r\n86|29\r\n86|49\r\n86|91\r\n86|75\r\n69|59\r\n69|83\r\n69|29\r\n69|38\r\n69|76\r\n69|61\r\n69|87\r\n69|25\r\n69|99\r\n69|55\r\n69|62\r\n69|17\r\n69|27\r\n69|73\r\n69|11\r\n69|89\r\n69|56\r\n69|15\r\n69|98\r\n69|97\r\n69|33\r\n69|31\r\n77|27\r\n77|26\r\n77|42\r\n77|86\r\n77|97\r\n77|49\r\n77|62\r\n77|65\r\n77|89\r\n77|15\r\n77|87\r\n77|59\r\n77|76\r\n77|56\r\n77|53\r\n77|61\r\n77|69\r\n77|91\r\n77|75\r\n77|83\r\n77|29\r\n21|94\r\n21|69\r\n21|42\r\n21|86\r\n21|95\r\n21|59\r\n21|77\r\n21|51\r\n21|99\r\n21|35\r\n21|15\r\n21|64\r\n21|75\r\n21|29\r\n21|26\r\n21|49\r\n21|16\r\n21|91\r\n21|72\r\n21|53\r\n47|42\r\n47|94\r\n47|86\r\n47|59\r\n47|77\r\n47|97\r\n47|29\r\n47|15\r\n47|83\r\n47|72\r\n47|99\r\n47|26\r\n47|16\r\n47|27\r\n47|56\r\n47|91\r\n47|89\r\n47|49\r\n47|65\r\n95|97\r\n95|35\r\n95|42\r\n95|99\r\n95|86\r\n95|59\r\n95|77\r\n95|69\r\n95|29\r\n95|57\r\n95|64\r\n95|47\r\n95|49\r\n95|91\r\n95|56\r\n95|75\r\n95|65\r\n95|26\r\n51|47\r\n51|75\r\n51|65\r\n51|89\r\n51|91\r\n51|86\r\n51|59\r\n51|35\r\n51|29\r\n51|99\r\n51|42\r\n51|26\r\n51|64\r\n51|69\r\n51|72\r\n51|49\r\n51|56\r\n49|42\r\n49|25\r\n49|99\r\n49|73\r\n49|59\r\n49|61\r\n49|15\r\n49|62\r\n49|32\r\n49|69\r\n49|76\r\n49|89\r\n49|98\r\n49|83\r\n49|31\r\n49|56\r\n31|47\r\n31|75\r\n31|35\r\n31|45\r\n31|64\r\n31|24\r\n31|16\r\n31|33\r\n31|91\r\n31|21\r\n31|53\r\n31|51\r\n31|55\r\n31|65\r\n31|95\r\n94|86\r\n94|42\r\n94|97\r\n94|59\r\n94|49\r\n94|15\r\n94|27\r\n94|72\r\n94|38\r\n94|89\r\n94|75\r\n94|87\r\n94|65\r\n94|29\r\n35|15\r\n35|38\r\n35|75\r\n35|65\r\n35|72\r\n35|69\r\n35|83\r\n35|59\r\n35|26\r\n35|16\r\n35|53\r\n35|77\r\n35|42\r\n53|15\r\n53|83\r\n53|87\r\n53|99\r\n53|73\r\n53|65\r\n53|97\r\n53|29\r\n53|61\r\n53|38\r\n53|32\r\n53|56\r\n24|69\r\n24|77\r\n24|34\r\n24|26\r\n24|85\r\n24|57\r\n24|21\r\n24|72\r\n24|45\r\n24|53\r\n24|86\r\n75|76\r\n75|65\r\n75|89\r\n75|87\r\n75|49\r\n75|69\r\n75|38\r\n75|26\r\n75|15\r\n75|61\r\n89|98\r\n89|33\r\n89|59\r\n89|79\r\n89|25\r\n89|61\r\n89|31\r\n89|32\r\n89|42\r\n87|73\r\n87|24\r\n87|79\r\n87|17\r\n87|61\r\n87|47\r\n87|25\r\n87|76\r\n45|21\r\n45|91\r\n45|47\r\n45|35\r\n45|34\r\n45|65\r\n45|94\r\n42|33\r\n42|73\r\n42|61\r\n42|45\r\n42|25\r\n42|38\r\n29|33\r\n29|38\r\n29|56\r\n29|31\r\n29|42\r\n57|86\r\n57|77\r\n57|47\r\n57|75\r\n33|72\r\n33|85\r\n33|53\r\n79|69\r\n79|21\r\n26|72\r\n\r\n69,32,62,98,65,72,59,15,56,89,87\r\n64,35,16,77,86,75,91,26,49,69,89,15,99,59,29,42,56,97,38\r\n26,53,16,35,49,99,86,69,89,15,77,83,42,56,72,47,94,65,59,38,75,29,91\r\n69,98,87,89,73,38,15,76,62,11,61,55,42,83,29,97,99,56,31\r\n47,16,75,91,26,89,97,38,27\r\n47,16,95,55,11,51,34,24,94,79,35,45,57,32,73\r\n33,24,16,31,47,21,73,36,57,86,94\r\n33,79,45,75,95,17,51,94,36,34,25,47,24,55,16,53,86,57,85\r\n27,79,62,98,36\r\n79,36,75,98,21,85,47,33,16\r\n55,31,57,95,35,33,25,47,79,34,21,64,24,36,98,61,11,45,32,76,17\r\n32,27,38,99,89,25,31,61,55,33,56,29,59\r\n16,53,72,49,42,15,97,56,86,26,65,91,69,38,89,64,47\r\n25,17,31,55,33,24,85,45,21,51,95,57,64,35,94,77,86,75,53\r\n49,56,11,87,42,32,99,29,72,38,89,97,61,65,83,25,15,98,73,69,62,76,59\r\n95,85,86,15,53,21,89\r\n45,75,24,94,25,51,85,36,55,47,35,95,33,53,34\r\n57,21,86,16,85\r\n73,79,95,86,21,24,33,34,17,25,64\r\n33,11,31,64,25,17,73,36,21,76,51,34,57,45,98,47,95,16,32\r\n98,25,33,34,95,77,75\r\n51,94,64,95,34,21,35,53,86,24,79\r\n47,16,94,77,86,53,91,26,65,72,89,15,99,59,29,42,56,97,38,83,27\r\n32,99,26,59,65,87,49,29,91,62,56,27,61,75,69,97,72\r\n83,98,62,24,79,76,97,55,85,38,45\r\n49,89,15,29,42,38,62,87,61,76,11,73,31\r\n64,34,49,77,26,65,91,35,59,15,99,16,69,53,51,72,89,47,86\r\n98,17,79,85,95,16,75\r\n59,21,86,99,57,15,29,49,47\r\n73,85,98,76,24,33,32,27,29\r\n45,21,86,75,69\r\n83,97,45,55,76,56,33,42,36,38,25,17,62\r\n77,79,51,72,16,95,57,85,36,64,47,65,75,33,91,21,26\r\n72,26,34,47,59,89,64,95,57,53,94,21,49\r\n53,91,26,72,49,69,89,15,99,59,29,56,97,38,83,27,62,87,61,32,11\r\n35,57,91,26,45,53,99,51,34,77,94,69,65,15,86,75,89,95,16\r\n35,16,77,86,75,91,72,69,59,29,56,38,83\r\n26,49,89,99,59,29,42,56,83,27,87,61,76,32,11,73,98\r\n73,98,25,17,55,33,79,24,85,45,34,51,95,35,47,94,86\r\n69,89,15,99,59,29,42,56,97,38,83,27,62,61,76,32,11,73,98,25,17,31,55\r\n76,56,87,55,61,59,11,79,17,27,73\r\n97,38,83,27,87,61,76,73,17,31,55,36,45,34,21\r\n38,83,27,62,87,61,76,32,11,73,98,17,31,55,33,79,36,24,85,45,34,21,51\r\n76,55,33,79,24,45,95,64,16\r\n29,56,38,83,27,76,11,73,25,36,85\r\n53,91,26,65,72,49,69,89,15,99,59,29,42,97,38,83,27,62,87,61,76,32,11\r\n35,75,64,36,79,31,25,33,17\r\n49,76,56,69,32,31,59\r\n95,35,16,86,53,26,65,99,42\r\n94,77,86,75,26,65,72,49,69,89,29,42,56,83,27,62,87\r\n98,21,16,77,57,95,45,34,94,33,79\r\n95,57,64,16,53,72,49,89,15,59,56\r\n57,64,47,16,77,86,53,49,15,99,59\r\n76,32,11,73,98,25,17,31,55,33,79,36,24,85,45,34,51,95,57,64,35,47,16\r\n75,72,56,65,42,59,69,53,27,26,61,97,76,87,99,91,49,89,83,15,38\r\n59,56,97,38,27,61,76,11,98,17,31,33,79,36,24\r\n57,64,35,47,16,94,77,86,75,53,91,26,65,72,49,69,89,15,99,59,42,56,97\r\n15,83,89,69,99,38,97,29,73,62,27,72,91,76,65\r\n85,31,21,16,36,33,98,35,55,34,94,75,47,17,79,45,95,51,57,86,77\r\n57,72,16,99,51,94,89,45,53\r\n11,87,59,31,62,42,97,36,55,38,33,73,83,56,27,32,98,17,99\r\n34,25,47,98,79,85,95,55,24,86,94,45,33,77,17,21,31,57,35,51,36,75,64\r\n29,56,38,83,62,61,76,32,98,25,17,31,55,33,79,24,85\r\n87,61,32,11,73,98,25,17,31,55,33,36,24,85,45,34,21,51,95\r\n31,33,79,24,34,16,94,91,26\r\n79,34,91,33,16,47,26,35,24,45,75,77,31,64,51,95,86,21,57,55,94\r\n64,75,51,36,85,57,91\r\n89,15,56,97,38,83,62,87,76,32,73,25,31,55,33\r\n34,21,51,57,64,35,77,86,53,91,26,65,72,89,59\r\n83,62,87,61,32,17,24,85,45,21,95\r\n35,47,16,77,86,75,26,65,72,49,42,38,83\r\n33,83,31,56,98,15,59,17,79,97,61,76,62,42,32\r\n32,11,61,87,62,55,98,15,59,29,42,31,76,38,56,83,97\r\n61,49,15,42,87,72,53,76,27,29,38,62,65,59,75,26,83,56,91,86,89,69,99\r\n45,31,76,79,85,83,25,95,27,51,17,98,11,32,24\r\n53,59,27,87,32\r\n87,32,11,73,98,17,31,36,21,57,35\r\n65,72,49,69,89,15,99,59,29,42,56,87,61,11,73\r\n86,75,53,89,15,42,83,62,61\r\n38,24,83,73,32,34,87,11,79,33,36,25,27,98,45,85,31,21,55,61,17\r\n17,56,85,34,55,83,27,62,87,61,11,76,32,31,73,79,45,98,97,38,36,33,25\r\n47,16,26,65,69,29,27\r\n77,72,65,47,64,57,91,75,24,95,89,16,94,21,53,26,69\r\n91,15,57,77,72,64,16,65,95,86,53,42,89,59,99,69,47\r\n31,55,33,79,36,45,34,21,51,95,47,94,86,53,26\r\n64,24,75,35,25,16,36,95,85,47,55,53,77,31,33,57,17\r\n64,51,79,36,25,76,62,98,45\r\n62,61,56,36,55,17,33,31,87,79,32,98,25,73,45,38,76\r\n99,53,65,97,72,47,29,57,42,86,15,59,16\r\n77,59,49,38,42,26,69,65,56,27,89,29,15,53,86,91,61,87,62\r\n83,31,15,17,11,69,55,89,56,59,27\r\n49,69,89,15,99,59,29,42,56,97,27,62,87,61,76,11,73,98,25\r\n42,56,27,11,98,24,45\r\n57,64,35,47,16,77,86,75,53,91,26,65,72,49,69,89,99,59,29,56,97\r\n75,53,91,26,15,42,56,87,32\r\n69,89,15,99,59,29,56,83,27,62,76,73,55\r\n72,49,69,89,15,99,59,42,56,38,83,27,87,61,76,32,11,73,98,25,17\r\n38,24,17,79,85,61,98,11,73,25,45,87,33,56,32,55,31,76,62,83,27,36,42\r\n77,86,75,53,65,72,89,15,42,56,38,83,27,62,61\r\n11,73,98,25,31,79,85,34,21,51,57,64,35,47,77\r\n31,85,45,21,47\r\n42,15,49,38,87,62,76,61,97,73,83,27,31,17,29,89,56\r\n99,72,49,16,15,91,47,89,69\r\n33,79,87,61,76,11,55,45,25,34,98,32,83,51,85,38,31\r\n75,72,26,15,83,62,56,16,29,97,59,94,69,65,27,86,77,99,53,42,91,49,89\r\n33,45,51,57,77,53,91\r\n29,83,27,87,32,11,73,98,31,55,33\r\n73,98,25,17,55,33,79,36,24,85,45,34,21,51,95,64,47,16,86\r\n83,76,17,24,85,34,95\r\n95,57,35,47,16,94,77,75,53,91,26,65,72,49,89,15,99,59,29,42,56\r\n61,72,38,76,42,99,49,91,73\r\n75,87,86,69,59,89,53,27,94,42,56,99,29,26,62,83,77,91,38\r\n31,94,16,77,36,33,35,55,51,47,45,64,17,91,53,95,57,86,75\r\n64,35,47,16,94,77,86,75,53,91,26,65,72,49,69,89,59,29,56,97,38\r\n35,94,86,75,91,26,65,15,99,59,56,97,83\r\n98,25,57,21,62,61,55,87,51,85,24,45,76\r\n16,53,65,69,89,15,99,27,62\r\n51,95,57,64,35,16,86,75,91,65,72,29,42\r\n57,86,75,29,42,56,97\r\n95,64,98,47,51,76,31,11,32,55,34,17,36,24,35,45,57,21,79,61,85,73,25\r\n95,57,64,35,47,94,86,75,53,91,26,65,72,69,15,99,59,42,56\r\n64,17,45,24,85,94,55,95,21,32,73,79,34,31,11\r\n36,24,85,45,34,51,95,57,64,35,47,16,94,77,86,75,53,91,26,65,72,49,69\r\n53,49,26,72,27,56,16,29,47,69,83,89,97,42,86,91,65,15,99\r\n32,29,76,42,59,38,98,25,65,11,87\r\n53,26,64,47,16,65,51,49,57,21,59,72,99,91,34,77,86\r\n31,55,79,36,24,85,45,34,95,64,35,16,77,75,91\r\n69,85,51,94,57,72,47,15,77,45,65\r\n94,27,65,75,97,89,99,42,69,83,15,26,16,49,59,29,62\r\n32,11,73,98,31,55,79,36,24,34,21,57,64,16,94\r\n34,51,95,57,64,35,47,16,94,77,86,75,53,91,26,65,72,49,69,89,15,99,59\r\n64,47,16,94,77,75,53,91,65,72,49,89,15,59,29,42,56,97,38\r\n33,79,36,24,85,45,21,51,95,64,35,47,16,94,77,86,75,91,26,65,72\r\n72,75,77,65,64,21,57,95,51,33,26\r\n11,25,17,45,34,57,77\r\n24,85,34,95,57,64,47,77,86,75,91,69,89\r\n11,98,25,17,55,36,24,45,34,95,47,16,77\r\n77,86,75,53,26,65,49,69,89,99,59,29,42,56,97,38,83,87,61\r\n73,98,17,31,55,33,36,24,85,45,34,51,95,64,35,47,16,94,86\r\n85,72,36,26,95,69,75,77,57\r\n65,42,16,26,94,72,89,64,35,69,57,56,47,53,91,15,77,75,59,99,97,29,86\r\n34,25,73,32,62,27,97,85,11,61,98,31,38,87,17,24,36,55,21\r\n89,59,29,56,97,32,17,55,33\r\n75,21,26,55,77,85,33,64,51,36,95,16,45,53,35,65,34,47,57,91,94,86,24\r\n62,87,32,11,73,31,55,79,36,45,34,51,64\r\n72,89,99,56,32,25,17\r\n25,55,33,36,45,51,35\r\n45,34,21,51,64,47,94,77,86,75,53,91,65,72,49,89,99\r\n75,76,53,61,62,89,59,32,26\r\n76,61,79,62,73,97,55,27,33,25,34,24,85\r\n76,11,73,25,17,55,33,79,85,45,34,21,51,95,57,64,16\r\n61,56,17,11,31,59,42,55,32,27,38,97,15,29,33,98,25,89,73,62,99,83,76\r\n55,36,85,45,77,86,53\r\n36,73,97,42,27,83,99,79,38,55,59,87,62,25,98,32,29,31,61,11,76\r\n83,25,62,45,36,24,73,17,55,42,38,32,31,61,76,97,98,11,87,79,33\r\n25,17,31,33,79,36,24,85,45,34,21,51,95,57,64,35,47,16,94,77,86,75,53\r\n79,85,95,64,94,75,91,26,49\r\n36,85,34,95,64,35,77,86,75,53,91,26,65,72,69\r\n91,35,26,51,21,49,34,69,86,85,45,64,95,89,65,75,15,57,47,53,94\r\n91,26,65,72,49,69,89,15,99,59,29,42,56,97,38,83,27,62,87,61,76,32,11\r\n33,31,32,25,36,51,47,11,45,64,98,57,35,76,61\r\n25,45,73,51,85,36,57,86,21,31,34,98,64,47,95\r\n72,49,69,89,15,99,59,29,42,56,97,38,83,27,62,87,61,76,32,11,73,98,17\r\n75,53,91,26,65,72,69,89,15,99,59,29,56,97,38,83,62,87,61,76,32\r\n53,91,26,65,49,69,89,15,99,59,29,56,97,38,83,62,61,76,32\r\n17,33,79,24,34,21,57,53,91\r\n15,42,25,17,73,79,99,87,62\r\n32,73,25,24,35,47,94\r\n49,69,89,15,99,29,42,56,38,83,27,62,87,61,76,11,73,98,25,17,31\r\n85,45,34,21,51,57,64,35,47,16,94,77,75,91,26,65,72,49,15\r\n94,99,89,45,72,26,34\r\n42,32,83,61,27,31,29,55,56,79,17,11,15,25,97\r\n21,51,95,57,64,35,47,16,94,77,75,53,91,26,72,69,89,59,29\r\n87,76,32,11,73,98,25,17,31,55,33,79,36,24,85,45,34,21,51,95,57,64,35\r\n79,36,24,85,45,34,21,51,95,64,47,16,94,77,75,72,49\r\n34,24,76,64,33,62,85,45,95,73,17,79,25,36,61\r\n72,49,42,83,62,61,76,11,73,98,17\r\n42,15,91,59,65,95,35,94,47,57,56,53,75,72,26\r\n95,11,61,73,55,51,76,35,57,17,21,33,98,85,32,36,34,25,64\r\n97,83,61,32,11,73,98,25,17,31,55,33,79,36,85,34,21\r\n85,21,51,95,16,94,77,91,26,65,49,89,15\r\n72,29,32,69,49,83,89,15,42,27,65")
    {
        private List<string> rules;
        protected override void Solve()
        {

            rules = input.Split("\r\n\r\n")[0].Split("\r\n").ToList();
            List<string> updates = input.Split("\r\n\r\n")[1].Split("\r\n").ToList();

            foreach (string update in updates)
            {
                if (part1)
                {
                    if (CheckUpdate(rules, update))
                    {
                        string[] pages = update.Split(',');
                        result += int.Parse(pages[pages.Length / 2]);
                    }
                }
                else
                {
                    if (!CheckUpdate(rules, update))
                    {
                        result += ReorderUpdate(rules, update);
                    }
                }
            }
        }

        bool CheckUpdate(List<string> rules, string update)
        {
            List<string> pages = update.Split(',').ToList();
            while (pages.Count > 0)
            {
                string page = pages.ElementAt(0);
                pages.RemoveAt(0);

                foreach (string rule in rules)
                {
                    string before = rule.Split('|')[0];
                    string after = rule.Split('|')[1];
                    if (after == page)
                    {
                        foreach (string p2 in pages)
                        {
                            if (before == p2)
                            {
                                return false;
                            }
                        }
                    }
                }
            }
            return true;
        }

        int ReorderUpdate(List<string> rules, string update) //returns middle element of sorted update
        {
            List<string> pages = update.Split(',').ToList();
            pages.Sort((a, b) =>
            {
                foreach (string rule in rules)
                {
                    string before = rule.Split('|')[0];
                    string after = rule.Split('|')[1];

                    if (after == b && before == a)
                    {
                        return -1;
                    }
                    if (before == b && after == a)
                    {
                        return 1;
                    }
                }
                return 0;
            });
            return int.Parse(pages[pages.Count / 2]);
        }
    }
}
