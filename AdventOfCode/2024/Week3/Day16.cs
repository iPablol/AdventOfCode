using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using static System.Formats.Asn1.AsnWriter;
using static System.Net.Mime.MediaTypeNames;
using static System.Windows.Forms.AxHost;

namespace AdventOfCode._2024
{
    internal class Day16() : Problem("#################\r\n#...#...#...#..E#\r\n#.#.#.#.#.#.#.#.#\r\n#.#.#.#...#...#.#\r\n#.#.#.#.###.#.#.#\r\n#...#.#.#.....#.#\r\n#.#.#.#.#.#####.#\r\n#.#...#.#.#.....#\r\n#.#.#####.#.###.#\r\n#.#.#.......#...#\r\n#.#.###.#####.###\r\n#.#.#...#.....#.#\r\n#.#.#.#####.###.#\r\n#.#.#.........#.#\r\n#.#.#.#########.#\r\n#S#.............#\r\n#################",
        "#############################################################################################################################################\r\n#...#.................................#...#...#...............#...............#.........#...............#...#.....#.........#.....#........E#\r\n#.###.#.#####.###########.#.#.#####.#.#.#.#.#.#.###.#####.#.###.#########.#.#.#.#.#####.###.#######.#####.#.#.#.#.#######.#.#.#.###.###.###.#\r\n#.........#...#.........#.#.#.........#.#...#.....#.....#.#.....#.........#.#...#.#...#...#.....#...#.........................#.....#...#.#.#\r\n#######.###.#####.###.###.#########.#.#.###############.###.#####.#########.#.###.###.###.#####.#.#.#.#########.###.#.#.#.###.#######.###.#.#\r\n#.........#.....#...#.#...#.........#...#...#...#.............#...#.#.....#.#...#...#...#.......#...#.....#...#...#...#.#...#.....#...#...#.#\r\n#.#######.#.###.#.#.###.###.#######.#.#.#.#.#.###.###.#.#####.#.###.#.#.#.#.#.#.###.#.#.#.#######.#.#####.#.#.###.#####.###.###.###.###.#.#.#\r\n#.#...#.#.....#.#.....................#...#...#...#.#.#...#...#.#.....#.#.#...#...#.#.........#...#.....#.#.#...#.....#.....................#\r\n#.#.#.#.#####.#.#####.#.###.#.#.#.#.#.#.#######.###.#.###.#.#.#.###.###.#####.###.#.#.#.#.#.###.###.###.#.#.###.#####.###.#####.#.###.#.#####\r\n#.#.#.#.......#.....#.#.....#.#.#...#...#.........................#...#.........#.#.#.#...#.#.....#.#...#.#...#.#.....#.#.....#.#.#.......#.#\r\n#.#.#.#######.#####.#.#######.#.###.#.###.#######.#######.#.#.#.#.###.#######.###.#.###.#.###.#####.#.###.#.#.###.#####.#####.###.#######.#.#\r\n#...#.......#.......................#.#...#.....#...#...#.#...#.#.#.......#.......#...#.#.#...#...#.#.....#.#...#...#.............#...#.#...#\r\n#.###.#####.#########.###.#.#####.#.#.#.#####.#.###.#.#.###.#.###.#########.#.#######.#.#.#.###.#.#.###########.###.#.#########.###.#.#.###.#\r\n#...#.....#.#...#.........#.#...#...#...#.....#...#.#.#.....#...#...#.......#.......#.#.#.#.#.........................#.......#.#...#.#...#.#\r\n#####.###.#.#.#.#.###.#####.#.#.###.#####.#########.#.#####.###.#.#.#.#######.#.#.###.#.#.#.#.###.#.###.#########.#.###.#####.#.#.###.#.#.#.#\r\n#.....#.....#.#.#...#.#.....#.#.#.......#...........#.....#.....#.#.#.#.#.......#.#...#.#...#...#...#...#.......#.#.....#...#.#.#.#...#.#...#\r\n#.###.#######.#####.#.#.#####.###.#######.###.###########.#####.###.#.#.#.###.###.#.###.#######.#.#.#.###.###.###.#######.###.#.#.#.#########\r\n#.#.......#...#.......#.#...........#.....#.............#.....#.#...#.#.....#.#...#...#.#.#...#.#.#...#.#.#.#.............#...#.#.#.#.......#\r\n#.#.#.###.#.#.#.#######.#.#####.#####.#######.#########.#####.#.#.#.#.#######.#######.#.#.#.#.#.#.###.#.#.#.#############.#.#####.#.#.#####.#\r\n#.#.....#.#.#...#...#...#.#...#.#.....#.....#.....#...#.#.....#.#.#.#.....#...#.......#.#.#.#...#.#...#.#.....#.#...#...#.#.......#...#...#.#\r\n#.###.#.#.#####.#.#.#.###.#.#.###.#####.###.###.#.#.#.#.#.#####.#.#######.#.#.#.#######.#.#.#####.#.#.#.#####.#.#.#.###.#.#########.###.#.#.#\r\n#.......#.....#.#.#...#...#.#.#...#...#...#.#.....#.#...#.#...#.#.#.......#.#.#...#...#...#.......#.#.....#.....#.#...#...#.............#.#.#\r\n#.###.#######.#.#.#########.#.#.###.#.###.#.#.#####.#####.#.#.#.#.#.#######.#.###.#.#.#.#.#######.#.#######.#####.###.#.#.#.#####.#########.#\r\n#.....#.....#.#.#.........#.#...#...#...#.#...#...#.#.....#.#.#.#.#...#...#.#...#.#.#.#.......#.........#...#.#...#...#.#...#...#.#.....#...#\r\n#####.#.###.#.#.#.#######.#.#####.#.###.#.#####.###.###.###.#.#.#.#.#.#.#.#.###.#.#.#.###.#####.#######.#.###.#.###.###.#.#.#.###.#.###.#.###\r\n#...#.#...#.....#.#.....#.#.#...#.#.#.........#...#.....#.#.#...#.#...#.#...#...#.#.#.....#.......#...#.#.#...#.#.......#.#.#.....#.#.#.#...#\r\n#.#.#.###.#.###.#.###.###.#.#.#.#.#.#######.#.#.#.#######.#.#####.#.###.#.#######.#.#######.#####.#.###.#.#.###.#.###.#####.#######.#.#.#.#.#\r\n#.#.#.#...#.....#...#...#...#.#...#...#...#.#...#...#.....#...#...#.#...#.#...#...#...#.....#...#.#...#.....#...#...#.......#.......#.#.#.#.#\r\n#.#.#.#.#.#####.###.###.#####.#######.###.#.#####.###.###.###.#.###.#.#.###.#.#.###.###.#####.#.#.###.#######.#####.#######.#.#######.#.#.#.#\r\n#.#.#...#.#.....#.....#.............#...#...#...#.....#.#.......#...#.#.#...#...#...........#.#.#.....#.......#.....#...#...#.#.......#...#.#\r\n#.###.###.#.#########.#.###########.###.#.###.#.###.###.#########.#####.#.#########.#.#######.#.#.#####.#######.#####.#.#.###.###.#######.#.#\r\n#.....#...#.........#.#...#.......#...#.#.....#...#.......#.....#...#...#.....#...#.#.#.#.....#.#.#...........#...#.......#.#.#...#.......#.#\r\n#.###.#.###########.#.###.#.#####.#####.#########.#.###.###.###.###.#.###.###.#.#.#.#.#.#.#####.###.#####.#.###.#.#.#######.#.#.###.###.#.#.#\r\n#...#...#.....#.....#.#...#.#...#.#...#.....#...#.......#...#.....#...#.....#.#.#.#.#.#.#.#...#.....#.....#.#...#.....#.....#.......#...#...#\r\n###.#####.#.###.#####.#####.###.#.#.#.#####.#.#.#####.###.###.#####.###.###.#.#.#.###.#.#.###.#######.#####.#.#######.#.#.#.#.#####.#.#.#.###\r\n#.........#.#...#...#.#.....#...#.#.#...#...#.#.#.....#...#...#.....#...#...#...#...#...#...#.......#...#...#.#...#...#.#.#.#.....#.#.#.....#\r\n#.#########.#.#####.#.#.#####.###.#.###.#.#####.#.#####.###.#.#.#####.###.#########.###.###.#####.#####.#.###.#.#.#.#####.#######.#.#.#.#.#.#\r\n#...#.......#.#.....#...#...#.#...#.#.#.#.....#.#.#...#.#.#.#.#...#...#...#...#...#.......#.....#.....#.#...#.#.#.#.....#.#...............#.#\r\n###.#.#######.#.###.#####.#.#.#.###.#.#.###.#.#.#.#.###.#.#.#####.#.###.###.#.#.#.#.###########.#.#.#.#.###.#.#.#.###.#.#.#.#.#.###.#.#.#.#.#\r\n#.....#...#...#.#.....#...#...#.#...#.#...#.#.#.....#...#.#.....#.#.#.......#...#.#.#.#.......#.#.#.#.#.#.#.#...#.#...#.#...#.#.#.#.#.#.#...#\r\n#.#####.#.#.###.#######.#.#####.#.###.###.###.#.#####.###.#####.#.#.#####.#######.#.#.#.###.#.#.#.#.###.#.#.#####.#.#.#.#.###.#.#.#.#.#.###.#\r\n#.........#.#...........#.....#...#.....#...#.#.#.....#.......#...#...#.......#...#.#.#.#...#...#.#.......#...........#.#.#...#.............#\r\n#.#.#####.#.#.###############.#######.#.###.#.#.#.#####.#.###.#######.#.#.###.#.###.#.#.#.#######.###.###.#########.###.###.#.#.#.#.#.#.#.#.#\r\n#.#.#...#...#.#.............#.#.......#...#.#.#.#...#...#.#.#.......#.#.#.#.#.#.#.#...#.#.......#...#...#...#...........#...#.#.#.#...#...#.#\r\n#.#.#.#.#####.#########.###.#.#.###.#.#.#.#.#.#.###.#.###.#.#####.###.#.#.#.#.#.#.###.#.#.###.#.###.#.#####.#.#########.#.###.#.###.#.#.###.#\r\n#.#.#.#.....#.#.......#...#.#...#.#.#.#.#.....#.#...#.#.#.#.....#.#...#.#.#...#.#.......#.#...#.#...#.....#...#.......#...#...#.......#.#.#.#\r\n#.#.#.#######.#.#####.#####.#####.#.###.#########.###.#.#.###.###.#.###.#.#.###.#.#####.#.#.###.#.#####.###.###.#####.###.#######.###.#.#.#.#\r\n#.#.#.......#...#.#...#.......#...#.....#...#.....#.#...#...#.#...#.#...#.#.....#.....#.#.#.#...#.....#...#.#...#...#.#...#.....#.#.....#.#.#\r\n#.#.#.#####.#####.#.###.#####.###.#######.###.#####.#.#.###.#.#.###.#####.#.#.#######.#.#.#.#########.###.#.#.#####.#.#####.###.#.#.#.#.#.#.#\r\n#.#...#.....#.....#.....#...#...#...#.......#.#.#.....#.....#.....#.....#.#.#...#.....#.#.#.........#.#.#.#...#.....#.#.....#...#.#...#.....#\r\n#.###.#.#####.###.#######.#.###.#.#.#.#.###.#.#.#.#####.#.#############.#.#.###.#.#####.#.#######.###.#.#.###.#.#.#.#.#.#####.###.###.#####.#\r\n#...#.#...#.....#...#.....#...#.#.#...#.#...#.#.....#...#.#.............#.......#.#.....#...#.....#...#.#.....#.#.#.#.#...#.#.#...#.#.....#.#\r\n###.#.###.#.#######.#.#.#.###.#.#.#####.#.###.#######.###.#.#############.#########.#.#.#.###.#.###.#.#.#.#####.#.#.#.###.#.#.#.###.#.###.#.#\r\n#...#...#...#.....#.#.#...#.#.....#...#.#...#.#.......#...#.#...#.......#.....#.....#...#.#...#.#...#...#.....#.#.#.#.....#.#...............#\r\n#.###.#.#####.###.#.#.#####.#######.#.#.###.#.#.#.#.#######.#.###.#####.#####.#.###########.#.###.#####.###.#.#.#.#########.#.#####.#.#.#.#.#\r\n#.#...#.#.......#.#.#.#.....#...#...#.#.#...#.#.#...........#.#...#...#...#...#.#.....#.......#...#.......#.#...#.......#...#...#.#.#...#.#.#\r\n#.#.#.#.#.#######.#.#.###.#.###.#.###.#.#.###.#.###.#.###.#.#.#.###.#.#.###.###.#.#.#.#.#####.#.###.#####.#.#######.#.###.#.###.#.#.#.###.#.#\r\n#.....#.#.....#...#...#...#.....#...#.#...#...#...#.#...#...#...#...#.#.#...#...#.#.#...#.....#.#...#...#.........#.#.#...#.....#.....#...#.#\r\n###.#.#.#.#.#.#.###.###.#####.###.#.#.#####.###.#.#.###.#####.###.###.#.#.#####.#.#.#######.###.#.###.#.#.#.#.###.#.###.#############.#.###.#\r\n#...#.#.#...#.#.#.#.....#.........#.#.#.....#.#.#.#.#.#...#.#...#.#...#.#.#.....#.#.......#.#.#.......#...#.#...#.#...#.....#.......#...#...#\r\n#.#.#.#.###.###.#.###.#########.###.#.#.#####.#.#.#.#.###.#.###.###.#.#.#.###.###.#.#####.#.#.#.###.#.#####.#.#.#.###.#.###.#.#####.#.###.###\r\n#.#...#.....#...#.....#.............#.....#...#.#.#.#...#.#...#...#.#.#.#.#...#.#.#.......#.#.....#.#.#...#...#.#.#.#.....#...#...#.#.#.....#\r\n#.#.#.#######.#.#######.#############.###.#.#.#.#.#.###.#.#.#####.#.#.#.#.#.###.#.#.#######.#.#####.#.#.#.#####.#.#.#####.#######.#.#.#####.#\r\n#.............#.#...#.....#...#.......#.#.#.#...#.#.....#.#.....#.#.#.#.....#.....#.#...#.....#.....#.........#.#.#.....#.........#.#.....#.#\r\n#.###.#######.###.#.#.#####.#.#.#####.#.#.#.#####.#######.#.###.#.#.#.#######.#####.###.#.#####.#######.###.#.#.#.#####.#####.#.###.#.###.#.#\r\n#.#.......#...#...#...#.#...#.....#...#...#.#.....#.....#.#.#.#.......#...#.#...#.#...#...#.....#.#.....#...#...#...........#.#.#...#...#.#.#\r\n#.#.#####.#.###.#######.#.#######.#.###.#####.#.###.###.#.#.#.#########.#.#.###.#.###.#.###.#####.#.#.###.###########.#######.#.#.###.###.#.#\r\n#...#.....#...#.#.......#.#...#...#.#.........#.#...#.#...#.#.#...#...#.#.#...#.....#.#.#...#.....#.#.....#.......#...#...................#.#\r\n#.###.#########.#.###.###.#.#.#.###.#############.#.#.#####.#.#.#.#.#.#.#.###.#.#.###.#.#.###.#.#.#.###.###.#####.#.###.###.#####.###.#.###.#\r\n#...#.....#.....#...#.#...#.#.#.....#...#.......#.#.....#.....#.#...#...#.#...#.#...#.#.#.#...#.#.#.#...#...#...#.#...#.#...#.....#.....#...#\r\n#########.#.#######.#.#.###.#.#####.#.#.#.#####.#.#.###.#.#####.#########.#.###.#.#.#.#.#.#.###.#.#.###.#.###.#.#.#.###.#.###.#####.#.#######\r\n#.........#.......#.#.#.....#.....#.#.#...#...#...#...#.#...#...#.....#...#...#.#.#.....#.#.#...#.#.......#...#.#...#...#...#.#.......#.....#\r\n#.###############.#.#############.#.#.###.#.#.#####.#.#####.#.###.###.#####.#.#.#.#######.#.#.###.#########.###.#####.#####.#.#.#####.#.###.#\r\n#...#.........#...#.............#.#...#...#.#.#.....#.....#.#.#...#.#.....#.#.#.#.......#.#.#...#.#.....#.....#...#...#.#...#.#.#.#...#.#...#\r\n###.#.###.#####.#.#.###.###.###.#.#.#######.#.#####.#####.#.#.#.###.###.#.###.#.#######.#.#.###.#.###.#.#####.###.#.###.#.###.#.#.#.###.#.#.#\r\n#...#.#.#.....#.#.#.#.#.......#.#.#.........#.....#.....#...#.#.....#...#...#.#...#...#...#...#.#.......#...#...#.#.#.....#...#...#.#...#.#.#\r\n#.#.#.#.#####.#.#.#.#.#######.###.#.#############.#.###.#.###.#.###.#.#####.#.###.###.#######.#.#.#.###.#.#.###.#.#.#######.#####.#.#.###.#.#\r\n#.#.#.#.....#...#.#...#...#.#...#...#.#.....#...#.....#.#...#...#...#.....#.....#.....#.......#.#.......#.#.....#.#.........#.#...#...#...#.#\r\n#.###.#.#########.###.#.#.#.###.#####.#.#.###.#.#######.#.#####.#.#######.#####.#####.###.#####.#.#######.#######.###########.#.###.#.#.#####\r\n#.....#.......#.....#...#.............#.#.....#.........#.#.....#.......#.#...#...#.#...#.#.....#.#.........#...#.......#...#...#.#...#.....#\r\n#.###########.#.#.#########.#.#####.###.#######.###.#.#.###.#########.###.#.#.###.#.###.###.#####.#.#######.###.#######.#.#.#.###.#########.#\r\n#...........#...#.#.......#.#.........#.#...#.......#.#.#...#.......#.#...#.#.........#.#...#.#...#...#.....#.........#...#.#.#.....#.....#.#\r\n#########.#.#.###.#.#.#####.#.###.###.#.#.###.#.#.#.#.#.#.#####.#.#.###.###############.#.#.#.#.#####.#.#####.#####.#.#####.#.#.###.#####.#.#\r\n#...#.......#...#...#.......#...#...#.....#...#.#...#.#.......#.#.#.....#.............#...#...#...#.#.#...#.........#.......#...#.#.#.....#.#\r\n#.###.###.###############.#.###.###.#######.###.#.#.#.#######.#.#.###.#.#.###########.#####.#####.#.#.###.#.#######.#############.#.#.###.#.#\r\n#...#.#...#.....#...#...#.#...#.#...#.....#.#.#...#.#.........#.#.#.#.#...#...........#.....#.....#.#.#.......#...#.#.............#...#...#.#\r\n#.#.#.#.#.#.###.#.#.#.#.###.#.#.#.###.###.#.#.#####.#############.#.#.#####.#######.###.#.#.#.#####.#.#.#######.#.###.#######.#####.#####.#.#\r\n#.#.#.#.#...#.#...#...#.....#...#.....#...#.#...#...#.....#.......#.#...........#...#...#.#...#...#...#...#.....#...#.....#.#.......#.......#\r\n###.#.#.#.###.#####.#######.###########.###.#.###.#######.#.###.###.#####.#.###.###.#.###.#.#.#.#.#####.#.#.#######.#####.#.#######.#.#####.#\r\n#...#.#...#.............#...#...#.......#...#.............#...#...#.....#.#...#...#.#...#.#.#...#.......#.....#.....#.#.........#...#.....#.#\r\n#.#.#.###.###.#.#########.###.#.#.#######.###################.###.#.###.#.###.###.#####.#.#############.#.#####.###.#.#.#######.###.#####.#.#\r\n#.#.#.#...#...#.#...#.....#...#.#.........#.........#...#.....#...#.#.#.#.#.#.#.#.....#.#...#.........#.#...#...#.....#.#.#...#.......#...#.#\r\n#.###.#.###.###.#.#.#.#####.###.###########.#######.#.#.#.###.#.###.#.#.#.#.#.#.###.###.###.#.#######.#.###.#.###.#####.#.#.#.#####.#.#.#####\r\n#...#.#...#.......#.....#.....#...........#.......#...#...#...#.#.#.#.#...#.#.............#.#.#.#...#.#...#.#.....#...#.#.#.#...............#\r\n###.#.#.#.#.###########.#.###.###########.#######.#########.###.#.#.#.#####.#####.#######.#.#.#.#.#.#.###.###.#####.#.#.#.#.#######.###.###.#\r\n#...#.#.............#.#.#...#...#.....#.#.......#...........#...#.#...#.........#.#...#...#.....#.#...#.#.#...#.....#.#...#.#...#.#...#...#.#\r\n#.#.#.###.#.#.#.###.#.#.###.#.#.###.#.#.#.#####.#########.###.###.###.#######.#.#.#.#.###########.###.#.#.#.#.#.#####.###.#.#.#.#.#.#.#.###.#\r\n#.#.#...#.#.#.....#.#.#.#...#.#.....#...#.....#...#...#...#...#.#.....#.....#.....#.#...#.........#.#...#.#.#.#.#...#.....#...........#.#...#\r\n#.#####.#.#.#######.#.#.#.###.#########.#####.#####.#.#.###.###.#.#####.###.#######.###.#.#########.###.#.#.###.###.###########.#.#.#####.#.#\r\n#.......#.....#.....#.#.#.#.....#.....#.#...#.......#.....#.#...#...#...#.#.#.........#.#...#.#.........#.#...#...#.......#.....#.......#.#.#\r\n#.###.#####.#.#.#####.#.#.#####.###.#.#.###.###############.#.#####.#.###.#.#.#.#####.#.###.#.#.#.#######.#.#.#.#.#.###.#.#.#####.#.#.#.#.###\r\n#.#...........#.#...#...#.#...#.#...#.#.#.....#...#...#...#.#.....#.#.#...#...#.#...#.#.....#.#.#.#.......#.#.......#...#.#.#.#...#.#...#...#\r\n#.###.#####.###.#.#.#####.#.#.#.#.###.#.#.###.#.#.#.###.#.#.#.###.#.#.#.#.#####.#.#.#.###.#.#.#.#.#.###########.###.#.#####.#.#.#.#.#.#.###.#\r\n#...#.....#.....#.#.........#...#.#.....#.#.....#...#...#.#...#.#.#...#.#.#.....#.#.#.............#...#.......#.....#...#...#...#.#...#...#.#\r\n###.#.###.#.#####.#######.#######.#.###.#.#######.###.###.#.#.#.#.#####.#.#.#####.#.###.#######.#.###.#.#####.###.#.###.#.###.###.#######.#.#\r\n#...#.#.#.#.......#.....#...#.....#...#.#...#.....#...#.....#...#...#...#...#...#.#...#...#.....#.#...#.....#...#.#.....#.#.....#.#.......#.#\r\n#.###.#.#.#.#######.###.#.#.###.#######.###.#.#####.###.#######.#.#.#.#########.#.#.#.###.#.###.###.#######.###.#.###.#.#.#.#####.#.#######.#\r\n#.....#.#.#.........#...#.#...#...#...#...#.#...#...#.........#.#.#.#...#.....#...#.#.#.#.#...#...#.....#...#...#.......#.#.#...#.#.#.......#\r\n#####.#.#.#.#######.#.###.###.#.#.#.#.###.#.#.#.#.#####.#.#.###.#.#####.#.###.#.#.#.#.#.#.###.###.#####.#.#.#.###.#######.#.#.#.#.#.###.#####\r\n#.#...#...#.........#.....#...#.#...#...#...#.#...#...#.#.......#...#...#.#.....#...#.#.....#.#.#.....#.#...#.#...#.......#.#.#.#.#...#.....#\r\n#.#.#.#.###.#########.#####.###.#####.#.#.###.###.#.#.###.#.#######.#.###.#######.#.#.#.#####.#.#####.#.#.#.#.#####.#######.#.#.#.###.#.###.#\r\n#...#...#.#...#.....#.#...#...#.#...#.#.#.#...#.....#...#.#.......#...#.......#.....#...#.....#.....#...#.#.#.....#.#...#...#.#.....#.#.#.#.#\r\n#.###.###.#.#.#.###.###.#.###.###.#.###.#.#.###.#######.#.###.#.#########.###.#.#####.###.#########.#######.#####.#.#.###.###.###.#.#.#.#.#.#\r\n#...........#...#.#.........#.....#...#.#.#.#...#...#.#.#...#.#.........#...#.#.....#.....#.......#.........#...#...#.....#.#.....#.#.#...#.#\r\n#.###.#.###.#####.#########.#########.#.#.#.#.###.#.#.#.###.#.###.#####.#.#.#.#####.#######.#####.###.###.#####.#####.#####.#####.###.#.#.#.#\r\n#.#...#.#.............#...#.#.....#...#...#.#.....#...#.....#.....#.....#.#.#...#...#.......#...#...#.#.#.#.......#...#.....#...#.....#...#.#\r\n#.#.###.#.#.###########.#.#.###.#.#.#######.#########.###.#.###.###.#####.#.#.#.#.#####.#.###.#####.#.#.#.#.#.#####.###.###.#.#.#.#####.###.#\r\n#.#...#.#.#.#...........#...#.....#.......#.......#...#.#.#.#...#.#...#.....#...#...#...#.#.....#...#...#.#.#.......#...#...#.#.........#.#.#\r\n#.###.#.#.###.#.#############.###.#######.#.###.###.###.#.#.#.###.###.#######.#.###.#.###.#.###.#.#.#####.#.###########.#.###.###.#####.#.#.#\r\n#...#.#.#.#...#.#...#.#.......#...#.....#.........#.#...#.#...#.....#.......#.#.#...#.#.....#.#.#.#...........#.........#.#.#.#...........#.#\r\n###.#.#.#.#.#####.#.#.#.#####.#.###.#########.###.#.###.#.#####.###########.#.#.#.###.#.#####.#.#.#.#########.#.#.#######.#.#.#.#######.###.#\r\n#...#.#.#.#.#.....#.#...#.....#...#.........#...#.......#.#.......#...#.....#.#.#...#.#...#...#...#.#.......#.#.#.......#.#.....#.....#...#.#\r\n#.###.#.#.#.#.#####.###.#.###.###.#####.#######.#.#####.#.###.###.#.#.#.#####.#.###.#.###.#.#.#####.###.#.#.#.###.#####.#.#.#####.###.#.#.#.#\r\n#.#.....#.#.......#...#.#.......#.#...#.....#...#.#...#.#...#.#.#...#.#.......#...#.#...#...#.#.......#.#.#.#...#.....#.#.#.#...#...#...#.#.#\r\n#.#.#####.#########.#.#########.#.#.#.#.#.#.#.#####.#.#.###.#.#.#####.#.###.#####.#.###.###.#.#.#####.#.#.#####.#####.#.#.###.#.###.###.#.#.#\r\n#.............#...#.#.#.....#...#...#.#...#.#.#.....#.#...#.#.....#.#.#.....#.#...#...#.#...#.#.#.....#.#.....#...#...#.#.....#.....#.....#.#\r\n#.#.#####.#.###.#.###.#.###.#.#######.#.###.#.###.###.#.###.#####.#.#.#######.#.#####.#.#.#.#.#.###.#.#######.###.#.###.#############.#.###.#\r\n#.#.......#.#...#...#.#...#...#...#...#...#.#.....#.#.#.#...#...#.#.#.#.........#.....#...#.#.#.#...#.#.........#.#...#.#.......#...#...#...#\r\n#.###.#######.#####.#.###.#####.#.#.#######.#######.#.###.###.#.#.#.#.#.###.#####.###.#.###.#.#.#.###.#.#########.#####.#.#####.#.#.###.#.#.#\r\n#.....................#...#...#.#...............#.#...#...#...#.#.#.#.#.........#.#...#.#...#.#...#...#.........#.#.....#.#.......#...#...#.#\r\n###.###.#######.###.#.#.#.#.#.#.#########.#####.#.#.###.###.###.#.#.#.###.#.#####.#.#.###.###.#.###.###.#######.#.#.#####.#.#######.#######.#\r\n#.#.....#.........#...#.......................#...#.....#.....#.#...#.....#.....#.#.#.....#...#.....#.....#...#.#...#.....#.....#.........#.#\r\n#.###############.#####.###.#.###.#.#.###.###.#######.#.#.#####.#####.#####.###.#.#.#######.#####.#######.#.###.#######.#.#####.#.#.#.#####.#\r\n#.#.............#.......#...#...#...#.#.....#...#...#.#...#...#.....#...#...#.............#.#...#.....#...#.#.........#.#...#...............#\r\n#.#.#.#########.###.#####.#####.###.#.###.#.###.#.#.#.#####.#.#####.###.#.#.#.###.#.#.#.###.#.#.#####.#.###.#.#######.#####.#.###.#.#########\r\n#.#.#.#...#.........#...#.#...#.#...#.....#.#.#.#.#.#.#.....#.......................#.#.#...#.#.......#.#...#.#.............#.#...#.......#.#\r\n#.#.#.#.#.###########.#.#.#.###.#########.#.#.#.#.#.#.#.#############.###.#.#######.###.#.###.#########.#.#.#.#####.#######.###.###.#.###.#.#\r\n#...............#...#.#...#...#.......#...#.#.#.#.#...#.#...........#.#...#.........#...#.#...#...#...#.#.#.#.#...#.#...#...#...#...#...#...#\r\n#.###.#.#.#.###.#.#.#.#######.#######.#.#.#.#.#.#.#####.#.###.#######.#.#####.#######.###.#.###.#.#.#.#.###.#.#.#.###.#.#####.###.#.###.#.#.#\r\n#S..#...#.....#...#.................#...#.....#.........#...#.........#.........................#...#.......#...#.....#...........#.....#...#\r\n#############################################################################################################################################")
    {
        private List<long> scores = [long.MaxValue];
        private Dictionary<(Pos pos, char direction), long> scoreMap = [];
        
        protected override void Solve()
        {
            ConstructMatrix();
            Pos start = Find('S').Value;
            matrix[start.y, start.x] = '>';
            Pos end = Find('E').Value;
            matrix[end.y, end.x] = '.';
            Search(start);
            result = scoreMap[scoreMap.Keys.Where(x => x.pos == end).First()];
        }

        // Flood Fill
        private void Search(Pos position)
        {
            PriorityQueue<(Pos pos, char direction), long> queue = new ();
            queue.Enqueue((position, '>'), 0);
            scoreMap[(position, '>')] = 0;
            while (queue.TryDequeue(out (Pos pos, char direction) info, out long score))
            {
                Pos pos = info.pos; char direction = info.direction;
                Pos front = Front(pos, direction).Value;


                if (score != scoreMap[(pos, direction)])
                {
                    continue;
                }
                foreach (var step in PossibleSteps(pos, direction))
                {
                    long newScore = score + step.increment;
                    if (scoreMap.ContainsKey(step.state) && scoreMap[step.state] <= newScore)
                    {
                        continue;
                    }
                    scoreMap[step.state] = newScore;
                    queue.Enqueue(step.state, newScore);
                }
            }
        }

        private IEnumerable<((Pos pos, char direction) state, long increment)> PossibleSteps(Pos pos, char direction)
        {
            Pos front = Front(pos, direction).Value;
            if (MatrixAt(front) == '.')
            {
                yield return ((front, direction), 1);
            }

            char clock = Turn(direction);
            front = Front(pos, clock).Value;
            if (MatrixAt(front) == '.')
            {
                yield return ((front, clock), 1001);
            }

            char counter = Turn(direction, false);
            front = Front(pos, counter).Value;
            if (MatrixAt(front) == '.')
            {
                yield return ((front, counter), 1001);
            }
        }
    }
}
